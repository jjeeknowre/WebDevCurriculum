webpackJsonp([1],{"0Wxd":function(e,t){},"9eIE":function(e,t){},NHnr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n("7+uW"),i=n("mvHQ"),o=n.n(i),r=n("BO1k"),a=n.n(r),c={name:"filelist",props:{files:{type:Array,required:!0},host:{type:String,required:!0}},data:function(){return{selectedIndex:null}},methods:{selectFile:function(e){this.selectedIndex=e},deleteFile:function(){this.$emit("deleteFile",this.selectedIndex),this.selectedIndex--}}},l={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("ul",e._l(e.files,function(t,s){return n("li",{key:t.name,class:{selected:s==e.selectedIndex},on:{click:function(t){e.selectFile(s)}}},[e._v("\n      "+e._s(t.name)+"\n    ")])})),e._v(" "),n("button",{staticClass:"openbtn",attrs:{disabled:-1==e.selectedIndex},on:{click:function(t){e.$emit("openFile",e.selectedIndex)}}},[e._v("open")]),e._v(" "),n("button",{staticClass:"deletebtn",attrs:{disabled:-1==e.selectedIndex},on:{click:e.deleteFile}},[e._v("delete")])])},staticRenderFns:[]};var u=n("VU/8")(c,l,!1,function(e){n("0Wxd")},"data-v-2e1d130e",null).exports,d={name:"Login",props:{host:{type:String,required:!0}},data:function(){return{userName:"",password:""}},methods:{loginClick:function(){var e=this;fetch(this.host+"/login",{method:"POST",headers:{"Content-Type":"application/json"},body:o()({username:this.userName,password:this.password})}).then(function(e){if(200!==e.status)throw"error";e.json()}).then(function(t){e.$emit("changeUser",e.userName)}).catch(function(e){console.log(e.message)})}}},h={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("form",{attrs:{onsubmit:"return false"}},[n("label",{staticClass:"userLabel"},[e._v("\n\t\t\tusername: \n\t\t")]),e._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.userName,expression:"userName"}],staticClass:"userInput",attrs:{autocomplete:"on"},domProps:{value:e.userName},on:{input:function(t){t.target.composing||(e.userName=t.target.value)}}}),e._v(" "),n("label",{staticClass:"passLabel"},[e._v("\n\t\t\tpassword: \n\t\t")]),e._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],staticClass:"passInput",attrs:{autocomplete:"on",type:"password"},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}}),e._v(" "),n("button",{on:{click:e.loginClick}},[e._v("\n\t\t\tlogin\n\t\t")])])},staticRenderFns:[]};var f=n("VU/8")(d,h,!1,function(e){n("9eIE")},"data-v-b7f9a3e2",null).exports,p=n("//Fk"),m=n.n(p),v={name:"TabBar",props:{host:{type:String,required:!0},openFiles:{type:Array,required:!0},selectedIndex:{type:Number,required:!0}},data:function(){return{}},methods:{newTab:function(){var e=this;new m.a(function(t,n){var s=window.prompt("Enter file name:");null!=s&&""!=s||n("File name must not be null"),s+=".txt";var i=!0,o=!1,r=void 0;try{for(var c,l=a()(e.openFiles);!(i=(c=l.next()).done);i=!0)s===c.value.name&&n("The file name "+s+" already exists.")}catch(e){o=!0,r=e}finally{try{!i&&l.return&&l.return()}finally{if(o)throw r}}t(s)}).then(function(t){return function(t){return fetch(e.host+"/files",{method:"POST",headers:{"Content-Type":"application/json"},body:o()({name:t,text:""})}).then(function(e){if(200===e.status)return t;throw"file already exists"}).catch(function(e){throw e})}(t)}).then(function(t){return n=t,e.$emit("newFile",{name:n,text:"",cursor:0}),void e.$emit("changeTab",e.openFiles.length-1);var n}).catch(function(e){return window.alert(e)})}}},b={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("nav",[n("button",{on:{click:e.newTab}},[e._v("\n    +\n  ")]),e._v(" "),n("ul",e._l(e.openFiles,function(t,s){return n("li",{key:s,class:{selected:s==e.selectedIndex},on:{click:function(t){e.$emit("changeTab",s)}}},[e._v("\n      "+e._s(t.name)+"\n    ")])}))])},staticRenderFns:[]};var x={name:"App",components:{filelist:u,login:f,tabbar:n("VU/8")(v,b,!1,function(e){n("tppp")},"data-v-1e8c5458",null).exports},data:function(){return{user:"",files:[],openedIndex:-1,tabIndices:[],host:"http://localhost:8080"}},computed:{currFile:function(){return this.openedIndex>=0?this.openFiles[this.openedIndex]:{name:"",text:"",cursor:0}},openFiles:function(){var e=this,t=[];return this.tabIndices.forEach(function(n){t.push(e.files[n])}),t}},watch:{user:function(e){var t=this;if(e){fetch(t.host+"/files",{method:"GET"}).then(function(e){return e.json()}).then(function(e){e.forEach(function(e){e.cursor=0}),t.files=e}).catch(function(e){console.log(e)}).then(function(){return fetch(t.host+"/users/"+t.user,{method:"GET"}).then(function(e){return e.json()}).then(function(e){var n=function(e){t.files.forEach(function(n,s){e.filename===n.name&&(n.cursor=e.cursor,t.tabIndices.push(s))})},s=!0,i=!1,o=void 0;try{for(var r,c=a()(e.Tabs);!(s=(r=c.next()).done);s=!0)n(r.value)}catch(e){i=!0,o=e}finally{try{!s&&c.return&&c.return()}finally{if(i)throw o}}t.openedIndex=e.opentab}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)})}else this.openedIndex=-1,this.files=[]}},methods:{updateUser:function(e){this.user=e},logout:function(){this.saveTabs(),this.user="",fetch(this.host+"/logout",{method:"GET"}).then(function(e){return e.json()}).then(function(e){console.log(e.message)})},saveTabs:function(){var e=this,t=[];this.tabIndices.forEach(function(n){var s=e.files[n];t.push({filename:s.name,cursor:s.cursor,user:e.user})}),fetch(this.host+"/users/"+this.user,{method:"PUT",headers:{"Content-Type":"application/json"},body:o()({tabs:t,opentab:this.openedIndex})}).then(function(e){return e.json()})},changeTab:function(e){this.openedIndex=e},newFile:function(e){this.files.push(e),this.tabIndices.push(this.files.length-1)},openFile:function(e){var t=this.tabIndices.indexOf(e);-1!==t?this.openedIndex=t:(this.tabIndices.push(e),this.openedIndex=this.tabIndices.length-1),this.$refs.textInput.focus(),this.$refs.textInput.setSelectionRange(2,2)},saveFile:function(){fetch(this.host+"/files/"+this.currFile.name,{method:"PUT",headers:{"Content-Type":"application/json"},body:o()({text:this.currFile.text})})},deleteFile:function(e){fetch(this.host+"/files/"+this.files[e].name,{method:"DELETE"}).then(function(e){return e.json()});var t=this.getNextTabIndex();this.openedIndex=t,this.files.splice(e,1)},closeFile:function(){var e=this.getNextTabIndex();this.tabIndices.splice(this.tabIndices.indexOf(this.openedIndex),1),this.openedIndex=e},getNextTabIndex:function(){var e=this.tabIndices.indexOf(this.openedIndex);return 1==this.tabIndices.length?-1:(e!==this.tabIndices.length-1?e++:e--,e)}},created:function(){var e=this;fetch(this.host+"/login",{method:"GET"}).then(function(e){if(200===e.status)return e.json();throw"please login"}).then(function(t){e.user=t.user}).catch(function(e){return e})},mounted:function(){window.addEventListener("beforeunload",this.saveTabs)}},g={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[e.user?n("section",[n("tabbar",{attrs:{host:e.host,openFiles:e.openFiles,selectedIndex:e.openedIndex},on:{newFile:e.newFile,changeTab:e.changeTab}}),e._v(" "),n("textarea",{directives:[{name:"model",rawName:"v-model",value:e.currFile.text,expression:"currFile.text"}],ref:"textInput",domProps:{value:e.currFile.text},on:{input:function(t){t.target.composing||e.$set(e.currFile,"text",t.target.value)}}}),e._v(" "),n("button",{staticClass:"logoutbtn",on:{click:e.logout}},[e._v("logout")]),e._v(" "),n("filelist",{attrs:{host:e.host,files:e.files},on:{openFile:e.openFile,deleteFile:e.deleteFile}}),e._v(" "),n("div",{staticClass:"buttonlist"},[n("button",{staticClass:"save",attrs:{disabled:""==e.currFile.name},on:{click:e.saveFile}},[e._v("save")]),e._v(" "),n("button",{staticClass:"close",attrs:{disabled:""==e.currFile.name},on:{click:e.closeFile}},[e._v("close")])])],1):n("login",{attrs:{host:e.host},on:{changeUser:function(t){e.updateUser(t)}}})],1)},staticRenderFns:[]};var I=n("VU/8")(x,g,!1,function(e){n("k9Ow")},null,null).exports;s.a.config.productionTip=!1,new s.a({el:"#app",components:{App:I},template:"<App/>"})},k9Ow:function(e,t){},tppp:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.d0909957dd912cf2fe03.js.map